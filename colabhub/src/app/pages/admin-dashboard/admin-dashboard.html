<div class="dashboard-container">
  <!-- LEFT SIDEBAR -->
  <aside class="sidebar">
    <!-- Logo (solo texto) -->
    <div class="sidebar-header">
      <h1 class="logo">ColabHub</h1>
      <p class="logo-subtitle">Gesti√≥n de colaboradores</p>
    </div>

    <!-- Navigation Menu -->
    <nav class="sidebar-nav">
      <a href="#" class="nav-item active">
        <span class="nav-icon">üë•</span>
        <span>Colaboradores activos</span>
      </a>
      <a href="#" class="nav-item">
        <span class="nav-icon">üè¢</span>
        <span>Colaboradores retirados</span>
      </a>
      <a href="#" class="nav-item">
        <span class="nav-icon">ü™ú</span>
        <span>Seguimiento curso alturas</span>
      </a>
      <a href="#" class="nav-item">
        <span class="nav-icon">üìö</span>
        <span>Cat√°logos</span>
      </a>
    </nav>

    <!-- User Profile at bottom -->
    <div class="sidebar-footer">
      <div class="user-profile">
        <img src="https://ui-avatars.com/api/?name=Admin&background=3498db&color=fff&size=128" alt="User" class="user-avatar">
        <div class="user-info">
            <p class="user-name">{{ currentUser?.full_name || 'Usuario' }}</p>
            <p class="user-role">{{ currentUser?.role === 'admin' ? 'Perfil de administrador' : 'Usuario' }}</p>
        </div>
        </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <!-- TOP HEADER -->
    <header class="top-header">
        <div class="header-left">
            <h1 class="greeting">Hola, {{ currentUser?.full_name || 'Usuario' }}</h1>
            <p class="subgreeting">Bienvenido/a</p>
        </div>
    </header>

    <!-- CONTENT AREA -->
    <main class="content-area">
        <div class="content-header">
        <h2 class="section-title">Colaboradores activos</h2>
        <p class="section-subtitle">Gestiona el estado y la informaci√≥n de tus colaboradores</p>
        </div>

        <!-- FILTRO DE B√öSQUEDA -->
        <div class="search-box">
          <select [(ngModel)]="tipoBusqueda" class="search-type-select">
              <option value="id">Buscar por ID</option>
              <option value="nombre">Buscar por Nombre</option>
          </select>
          
          <input 
              type="text" 
              [(ngModel)]="valorBusqueda" 
              [placeholder]="tipoBusqueda === 'id' ? 'Ej: 123456' : 'Ej: AND para ANDRES'"
              class="search-input"
              (keyup.enter)="buscar()">
          
          <button (click)="buscar()" class="btn-search">Buscar</button>
          <button (click)="limpiarFiltro()" class="btn-clear">Limpiar</button>
          <div class="spacer"></div>
          
          <!-- BOT√ìN DE EXPORTAR -->
          <button (click)="toggleModoSeleccion()" class="btn-export" [class.active]="modoSeleccion">
              üìä {{ modoSeleccion ? 'Exportar seleccionados' : 'Exportar a Excel' }}
          </button>

          <button (click)="abrirFormularioNuevoColaborador()" class="btn-add">A√±adir nuevo colaborador</button>
        </div>

        <!-- AGREGAR INFO DE SELECCI√ìN (si est√° en modo selecci√≥n) -->
        <div *ngIf="modoSeleccion" class="selection-info">
            <p>
                <strong>{{ colaboradoresSeleccionados.size }}</strong> colaboradores seleccionados
                <button *ngIf="colaboradoresSeleccionados.size > 0" 
                        (click)="limpiarSeleccion()" 
                        class="btn-clear-selection">
                    Limpiar selecci√≥n
                </button>
            </p>
        </div>

        <!-- MENSAJE DE ERROR -->
        <div *ngIf="error" class="error-message">
            {{ error }}
        </div>

        <!-- LOADING -->
        <div *ngIf="isLoading" class="loading-message">
            Cargando colaboradores...
        </div>

      <!-- TABLE -->
      <div *ngIf="!isLoading && !error" class="table-container">
        <table class="collaborators-table">
          <thead>
            <tr>
              <!-- COLUMNA DE CHECKBOX -->
              <th *ngIf="modoSeleccion" class="checkbox-column">
                <input 
                  type="checkbox" 
                  (change)="toggleTodos($event)"
                  [checked]="todosSeleccionados()">
              </th>
              <th>ID</th>
              <th>Tipo ID</th>
              <th>Primer Nombre</th>
              <th>Segundo Nombre</th>
              <th>Primer Apellido</th>
              <th>Segundo Apellido</th>
              <th>Email</th>
              <th>Fecha Ingreso</th>
              <th>Cargo</th>
              <th>√Årea</th>
              <th>Perfil</th>
              <th>Sede</th>
              <th>√öltimo Examen</th>
              <th>Fecha Nacimiento</th>
              <th>Edad</th>
              <th>G√©nero</th>
              <th>Pa√≠s Nacimiento</th>
              <th>Estado Nacimiento</th>
              <th>Ciudad Nacimiento</th>
              <th>Direcci√≥n de Residencia</th>
              <th>ARL</th>
              <th>EPS</th>
              <th>AFP</th>
              <th>ACCAI</th>
              <th>Cesant√≠as</th>
              <th>Caja Compensaci√≥n</th>
              <th>Celular</th>
              <th>RH</th>
              <th>Contacto Emergencia</th>
              <th>Celular Contacto de Emergencia</th>
              <th>Editar</th>
              <th>Retirar</th>
              <th>Curso de alturas</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let colaborador of colaboradores">
              <td *ngIf="modoSeleccion" class="checkbox-column">
                <input 
                  type="checkbox" 
                  [checked]="colaboradoresSeleccionados.has(colaborador.ID)"
                  (change)="toggleSeleccion(colaborador.ID)">
              </td>
              <td>{{ colaborador.ID }}</td>
              <td>{{ getNombreTipoID(colaborador.TipoID) }}</td>
              <td>{{ colaborador.PrimerNombre }}</td>
              <td>{{ colaborador.SegundoNombre  }}</td>
              <td>{{ colaborador.PrimerApellido }}</td>
              <td>{{ colaborador.SegundoApellido }}</td>
              <td>{{ colaborador.Email }}</td>
              <td>{{ colaborador.FechaIngreso }}</td>
              <td>{{ getNombreCargo(colaborador.Cargo) }}</td>
              <td>{{ getNombreArea(colaborador.Area) }}</td>
              <td>{{ getNombrePerfil(colaborador.Perfil) }}</td>
              <td>{{ getNombreSede(colaborador.IdSede) }}</td>
              <td>{{ colaborador.UltimoExamenOcupacional}}</td>
              <td>{{ colaborador.FechaNacimiento }}</td>
              <td>{{ colaborador.Edad }}</td>
              <td>{{ getNombreGenero(colaborador.Genero) }}</td>
              <td>{{ getNombrePais(colaborador.IDPaisNac) }}</td>
              <td>{{ getNombreEstado(colaborador.IDEstadoNac) }}</td>
              <td>{{ getNombreCiudad(colaborador.IDCiudadNac) }}</td>
              <td>{{ colaborador.DireccionResidencia }}</td>
              <td>{{ getNombreARL(colaborador.ARL) }}</td>
              <td>{{ getNombreEPS(colaborador.EPS) }}</td>
              <td>{{ getNombreAFP(colaborador.AFP) }}</td>
              <td>{{ getNombreACCAI(colaborador.ACCAI) }}</td>
              <td>{{ getNombreCesantias(colaborador.Cesantias) }}</td>
              <td>{{ getNombreCajaCompensacion(colaborador.CajaCompensacion) }}</td>
              <td>{{ colaborador.Celular }}</td>
              <td>{{ getNombreRH(colaborador.RH) }}</td>
              <td>{{ colaborador.ContactoEmergencia }}</td>
              <td>{{ colaborador.CelularContactoEmergencia }}</td>
              <td><a href="#" class="action-link">‚úèÔ∏è</a></td>
              <td><a href="#" class="action-link">üóëÔ∏è</a></td>
              <td><a href="#" class="action-link">‚úÖ</a></td>
            </tr>
            <tr *ngIf="colaboradores.length === 0">
              <td [attr.colspan]="modoSeleccion ? 34 : 33" class="no-data">
                No se encontraron colaboradores</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>

    <!-- MODAL NUEVO COLABORADOR -->
    <div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
      <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>A√±adir nuevo colaborador</h2>
          <button class="modal-close" (click)="cerrarModal()">&times;</button>
        </div>
        
        <div class="modal-body">
          <!-- MENSAJE DE ERROR DENTRO DEL MODAL -->
          <div *ngIf="errorModal" class="error-message-modal">
            {{ errorModal }}
          </div>
          <!-- MENSAJE DE √âXITO DENTRO DEL MODAL -->
          <div *ngIf="mensajeExito" class="success-message-modal">
            {{ mensajeExito }}
          </div>

          <form>
            <!-- Secci√≥n: Informaci√≥n Personal -->
            <div class="form-section">
              <h3 class="form-section-title">Informaci√≥n Personal</h3>
              
              <div class="form-row">

                <div class="form-group">
                  <label>Tipo ID *</label>
                  <select [(ngModel)]="nuevoColaborador.TipoID" name="TipoID" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let tipo of catalogos.tipoID" [value]="tipo.ID">
                      {{ tipo.TipoID }}
                    </option>
                  </select>
                </div>

                <div class="form-group">
                  <label>ID *</label>
                  <input type="text" [(ngModel)]="nuevoColaborador.ID" name="ID" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Primer Nombre *</label>
                  <input type="text" [(ngModel)]="nuevoColaborador.PrimerNombre" name="PrimerNombre" required>
                </div>
                
                <div class="form-group">
                  <label>Segundo Nombre</label>
                  <input type="text" [(ngModel)]="nuevoColaborador.SegundoNombre" name="SegundoNombre">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Primer Apellido *</label>
                  <input type="text" [(ngModel)]="nuevoColaborador.PrimerApellido" name="PrimerApellido" required>
                </div>
                
                <div class="form-group">
                  <label>Segundo Apellido</label>
                  <input type="text" [(ngModel)]="nuevoColaborador.SegundoApellido" name="SegundoApellido">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Email *</label>
                  <input type="email" [(ngModel)]="nuevoColaborador.Email" name="Email" required>
                </div>
                
                <div class="form-group">
                  <label>Celular </label>
                  <input type="tel" [(ngModel)]="nuevoColaborador.Celular" name="Celular" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Fecha de Nacimiento *</label>
                  <input type="date" 
                    [(ngModel)]="nuevoColaborador.FechaNacimiento" 
                    name="FechaNacimiento" 
                    (change)="calcularEdad()"
                    required>
                </div>
                
                <div class="form-group">
                  <label>Edad</label>
                  <input type="number" 
                    [(ngModel)]="nuevoColaborador.Edad" 
                    name="Edad" 
                    readonly>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>G√©nero *</label>
                  <select [(ngModel)]="nuevoColaborador.Genero" name="Genero" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let genero of catalogos.genero" [value]="genero.ID">
                      {{ genero.Genero }}
                    </option>
                  </select>
                </div>

                
                <div class="form-group">
                  <label>RH *</label>
                  <select [(ngModel)]="nuevoColaborador.RH" name="RH" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let rh of catalogos.rh" [value]="rh.ID">
                      {{ rh.NombRH }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Lugar de Nacimiento -->
            <div class="form-section">
              <h3 class="form-section-title">Lugar de Nacimiento</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Pa√≠s de Nacimiento *</label>
                  <select [(ngModel)]="nuevoColaborador.IDPaisNac" 
                          name="IDPaisNac" 
                          (change)="onPaisChange()" 
                          required>
                    <option value="">Seleccione...</option>
                    <option *ngFor="let pais of catalogos.paises" [value]="pais.ISO2">
                      {{ pais.Nombre }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>Estado/Departamento de Nacimiento *</label>
                  <select [(ngModel)]="nuevoColaborador.IDEstadoNac" 
                        name="IDEstadoNac" 
                        (change)="onEstadoChange()" 
                        required>
                    <option value="">Seleccione primero un pa√≠s...</option>
                    <option *ngFor="let estado of estadosFiltrados" [value]="estado.CodigoISO">
                      {{ estado.Nombre }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Ciudad de Nacimiento *</label>
                  <select [(ngModel)]="nuevoColaborador.IDCiudadNac" 
                          name="IDCiudadNac" 
                          required>
                    <option value="">Seleccione primero un estado...</option>
                    <option *ngFor="let ciudad of ciudadesFiltradas" [value]="ciudad.CodigoMunicipalNacional">
                      {{ ciudad.Nombre }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>Direcci√≥n de Residencia *</label>
                  <input type="text" [(ngModel)]="nuevoColaborador.DireccionResidencia" name="DireccionResidencia" required>
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Informaci√≥n Laboral -->
            <div class="form-section">
              <h3 class="form-section-title">Informaci√≥n Laboral</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Fecha de Ingreso *</label>
                  <input type="date" [(ngModel)]="nuevoColaborador.FechaIngreso" name="FechaIngreso" required>
                </div>
                
                <div class="form-group">
                  <label>Cargo *</label>
                  <select [(ngModel)]="nuevoColaborador.Cargo" name="Cargo" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let cargo of catalogos.cargo" [value]="cargo.ID">
                      {{ cargo.NombCargo }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>√Årea *</label>
                  <select [(ngModel)]="nuevoColaborador.Area" name="Area" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let area of catalogos.area" [value]="area.ID">
                      {{ area.NombArea }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>Perfil </label>
                  <select [(ngModel)]="nuevoColaborador.Perfil" name="Perfil" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let perfil of catalogos.perfil" [value]="perfil.ID">
                      {{ perfil.Perfil }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Sede *</label>
                  <select [(ngModel)]="nuevoColaborador.IdSede" name="IdSede" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let sede of catalogos.sede" [value]="sede.IdMun">
                      {{ sede.NombMun }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>√öltimo Examen Ocupacional</label>
                  <input type="date" [(ngModel)]="nuevoColaborador.UltimoExamenOcupacional" name="UltimoExamenOcupacional">
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Seguridad Social -->
            <div class="form-section">
              <h3 class="form-section-title">Seguridad Social</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label>ARL *</label>
                  <select [(ngModel)]="nuevoColaborador.ARL" name="ARL" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let arl of catalogos.arl" [value]="arl.ID">
                      {{ arl.NombreARL }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>EPS *</label>
                  <select [(ngModel)]="nuevoColaborador.EPS" name="EPS" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let eps of catalogos.eps" [value]="eps.ID">
                      {{ eps.NombreEPS }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>AFP *</label>
                  <select [(ngModel)]="nuevoColaborador.AFP" name="AFP" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let afp of catalogos.afp" [value]="afp.ID">
                      {{ afp.NombreAFP }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>ACCAI</label>
                  <select [(ngModel)]="nuevoColaborador.ACCAI" name="ACCAI">
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let accai of catalogos.accai" [value]="accai.ID">
                      {{ accai.NombreACCAI }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Cesant√≠as *</label>
                  <select [(ngModel)]="nuevoColaborador.Cesantias" name="Cesantias" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let cesantia of catalogos.cesantias" [value]="cesantia.ID">
                      {{ cesantia.NombreCesantias }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>Caja de Compensaci√≥n *</label>
                  <select [(ngModel)]="nuevoColaborador.CajaCompensacion" name="CajaCompensacion" required>
                    <option value="null">Seleccione...</option>
                    <option *ngFor="let caja of catalogos.cajaCompensacion" [value]="caja.ID">
                      {{ caja.NombreCaja }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Contacto de Emergencia -->
            <div class="form-section">
              <h3 class="form-section-title">Contacto de Emergencia</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Nombre Contacto de Emergencia </label>
                  <input type="text" [(ngModel)]="nuevoColaborador.ContactoEmergencia" name="ContactoEmergencia" required>
                </div>
                
                <div class="form-group">
                  <label>Celular Contacto de Emergencia </label>
                  <input type="tel" [(ngModel)]="nuevoColaborador.CelularContactoEmergencia" name="CelularContactoEmergencia" required>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
          <button type="button" class="btn-save" (click)="guardarColaborador()">Guardar Colaborador</button>
        </div>
      </div>
    </div>
  </div>
</div>